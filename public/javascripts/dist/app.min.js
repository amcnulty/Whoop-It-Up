var WIU=WIU||{};WIU.animate=function(){var a=function(a,b){var c=a.attr("data-id");if("string"==typeof c&&""!==c.trim()){var d=c.trim().split(" ");$.each(d,function(b,c){var d=$('<div class="wiu-animate">'+c+"</div>");a.append(d)}),b(a)}},b=function(a,b){return a*b},c=function(a,b,c){""!==b&&(a.addClass("animated "+b),a.off("oanimationend animationend webkitAnimationEnd").on("oanimationend animationend webkitAnimationEnd",function(){a.removeClass("animated "+b),"function"==typeof c&&c()}))},d=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},e=function(){var a=["hinge","rollOut","zoomOutDown","bounceOut"];return a[d(0,a.length-1)]};return{bounceWords:function(d,e,f){e=void 0!==e?e:0,a(d,function(){var a=d.find(".wiu-animate");if(a.each(function(a){var b=$(this);setTimeout(function(){c(b,"bounce")},e*a)}),"function"==typeof f){var g=b(e,a.length);setTimeout(function(){f()},g)}})},apply:c,slideIn:function(a){var b=new TimelineLite({paused:!0});a.each(function(a){var c=$(this);b.fromTo(c,.3,{opacity:0,right:-90},{opacity:1,right:0})}),b.play()},bkgSlideIn:function(a){var b=new TimelineLite({paused:!0}),c=a.css("backgroundPosition");b.fromTo(a,.6,{opacity:0,backgroundPosition:c},{opacity:1,backgroundPosition:"50% 100%"}),b.play()},leavePage:function(a){var b=$(".wrapper"),d=e();c(b,d,function(){b.css("display","none"),window.location=a})}}}();var WIU=WIU||{};WIU.createEvent=function(){var a=function(a,b){var c="AIzaSyCdPObqQECeLB2K0xW96U8Rhzd3sFS9d4k",d=a.split(" ").join("+"),e="https://maps.googleapis.com/maps/api/geocode/json?components=country:US&",f=e+"address="+d+"&key="+c,g={};$.ajax({method:"GET",url:f}).done(function(a){if("OK"===a.status&&1==a.results.length){var c=a.results[0].geometry.location.lat,d=a.results[0].geometry.location.lng,e=a.results[0].place_id,f=a.results[0].formatted_address;g.latlng=c+", "+d,g.placeID=e,g.formatted=f}else console.log("problem geocoding",a);"function"==typeof b&&b(g)})},b=function(a){var b=$(".address-suggest-div"),c=$(".address-suggest",".address-suggest-div");$(".suggest-cb",".address-suggest-div").prop("checked",!1),b.addClass("hidden"),void 0!==a.formatted&&""!=a.formatted&&(c.html(a.formatted),b.removeClass("hidden"))},c=function(){var c=$(".location",".create-events-page");c.on("blur",function(){var d=c.val();void 0!==d&&""!=d.trim()&&d.trim().length>1&&a(d.trim(),function(a){f(a),b(a)})})},d=function(){$("#event-date").datepicker()},e=function(a){return!(void 0===a.name||null===a.name||""===a.name.trim())},f=function(a){var b=".create-events-page",c=$(".place-id",b),d=$(".latlong",b),e=$(".formatted-addy",b);void 0!==a.placeID&&void 0!==a.latlng&&void 0!==a.formatted?(c.val(a.placeID),d.val(a.latlng),e.val(a.formatted)):(c.val(""),d.val(""),e.val(""))},g=function(){var a=$(".host-name"),b=$(".host-id"),c={id:1,name:"Gorilla Gang"};return a.length&&b.length&&(c={id:b.val(),name:a.val()}),c},h=function(){for(var a=$(".event-category"),b=[],c=0;c<a.length;c++)$(a[c]).is(":checked")&&b.push(parseInt(a[c].value));return 0==b.length&&b.push(7),b},i=function(){var a=".create-events-page",b=$(".event-name",a).val(),c=$(".event-date",a).val(),d=$(".start-time",a).val(),e=$(".location",a).val(),f=$(".event-desc",a).val(),i=$(".is-private-cb",a).is(":checked"),j=g(),k=h();return suggestCB=$(".suggest-cb",a).is(":checked"),locationObj={name:e},suggestCB&&(locationObj.placeID=$(".place-id",a).val(),locationObj.latlng=$(".latlong",a).val(),locationObj.formatted=$(".formatted-addy",a).val()),{name:b,date:c,time:d,location:e,description:f,isPrivate:i,host:j.name,hostId:j.id,geoData:locationObj,categories:JSON.stringify(k)}},j=function(){$(".create-btn").on("click",function(a){var b=i();if(!e(b))return $(".error-name").removeClass("hidden"),!1;$.ajax({method:"POST",url:"./event/createevent",data:b}).done(function(a){var b=parseInt(a.id);WIU.animate.leavePage("/event/"+b)}).fail(function(a,b,c){console.log("An error occured",a)})})};return{init:function(){$(".create-events-page").length&&(d(),j(),c())}}}(),$(function(){WIU.createEvent.init()});var WIU=WIU||{};WIU.event=function(){var a=function(){var a=$(".fb-btn"),b=window.location.href;a.attr("href","https://www.facebook.com/sharer/sharer.php?u="+b)},b=function(a){return!(void 0===a.name||null===a.name||""===a.name.trim())},c=!1,d=function(){$(".update-btn",".button-row").on("click",function(a){var c=j();if(!b(c))return $(".error-name").removeClass("hidden"),!1;$.ajax({method:"POST",url:"/event/updateevent",data:c}).done(function(a){WIU.animate.leavePage(window.location.href)})})},e=function(){$(".delete-btn",".button-row").on("click",function(a){$.ajax({method:"DELETE",url:"/event/delete/"+window.location.href.match(/\d*$/)[0]}).done(function(a){WIU.animate.leavePage("/profile/getuser/"+$("#hostLabel").attr("data-id"))})})},f=function(){return $(".latlong").val()},g=function(){var a=f(),b="",c=$(".map-image",".map");a=a||"-33.8569,151.2152",b="https://maps.googleapis.com/maps/api/staticmap?markers="+a+"&center="+a+"&zoom=12&size=350x200&key=AIzaSyAxQrQpPeVTP0SFDubCMCNtDaRqOjM-fxk",c.length&&c.attr("src",b)},h=function(){var a="AIzaSyCmiSi2gWmkkVWPwz-lk8N1Htd4Q50-Qz4",b="https://www.google.com/maps/embed/v1/search?key="+a+"&zoom=18&center=",c=f();(c=c||"-33.8569,151.2152")&&(b+=c,b+="&q=Fairmont+Empress,Victoria+BC",$(".g-map").attr("src",b))},i=function(){for(var a=$(".event-category"),b=[],c=0;c<a.length;c++)$(a[c]).is(":checked")&&b.push(parseInt(a[c].value));return 0==b.length&&b.push(7),b},j=function(){var a=".event-page",b=$(".event-name",a).val(),c=$(".event-date",a).val(),d=$(".start-time",a).val(),e=$(".location",a).val(),f=$(".event-desc",a).val(),g=$(".is-private-cb",a).is(":checked"),h=i();return suggestCB=$(".suggest-cb",a).is(":checked"),locationObj={name:e},suggestCB?(locationObj.placeID=$(".place-id-new",a).val(),locationObj.latlng=$(".latlong-new",a).val(),locationObj.formatted=$(".formatted-addy-new",a).val()):(locationObj.placeID=$(".place-id",a).val(),locationObj.latlng=$(".latlong",a).val(),locationObj.formatted=$(".formatted-addy",a).val()),{name:b,date:c,time:d,location:e,description:f,isPrivate:g,geoData:locationObj,categories:JSON.stringify(h),invite:{username:$("#inviteUser").val(),eventId:window.location.href.match(/\d*$/)[0]}}},k=function(){var a=[];$.ajax({method:"GET",url:"../profile/"}).done(function(b){for(var c=0;c<b.length;c++)a.push(b[c].username);$("#inviteUser").autocomplete({minLength:3,delay:50,appendTo:"#inviteUserSearchContainer",source:a})})},l=function(a,b){var c="AIzaSyCdPObqQECeLB2K0xW96U8Rhzd3sFS9d4k",d=a.split(" ").join("+"),e="https://maps.googleapis.com/maps/api/geocode/json?components=country:US&",f=e+"address="+d+"&key="+c,g={};$.ajax({method:"GET",url:f}).done(function(a){if("OK"===a.status&&1==a.results.length){var c=a.results[0].geometry.location.lat,d=a.results[0].geometry.location.lng,e=a.results[0].place_id,f=a.results[0].formatted_address;g.latlng=c+", "+d,g.placeID=e,g.formatted=f}else console.log("problem geocoding",a);"function"==typeof b&&b(g)})},m=function(a){var b=$(".address-suggest-div"),c=$(".address-suggest",".address-suggest-div");$(".suggest-cb",".address-suggest-div").prop("checked",!1),b.addClass("hidden"),void 0!==a.formatted&&""!=a.formatted&&(c.html(a.formatted),b.removeClass("hidden"))},n=function(a){var b=".event-page",c=$(".place-id-new",b),d=$(".latlong-new",b),e=$(".formatted-addy-new",b);void 0!==a.placeID&&void 0!==a.latlng&&void 0!==a.formatted?(c.val(a.placeID),d.val(a.latlng),e.val(a.formatted)):(c.val(""),d.val(""),e.val(""))},o=function(){var a=$(".location",".edit-event");a.on("blur",function(){var b=a.val();void 0!==b&&""!=b.trim()&&b.trim().length>1&&l(b.trim(),function(a){n(a),m(a)})})},p=function(a){"G"===a?($(".rsvp-btn",".cta").addClass("hidden"),$(".cancel-rsvp-btn",".cta").removeClass("hidden")):($(".rsvp-btn",".cta").removeClass("hidden"),$(".cancel-rsvp-btn",".cta").addClass("hidden"))},q=function(){c?p("G"):p()},r=function(a){$.ajax({method:"PUT",url:"/event/updatestatus",data:{status:a.status,eventId:a.eventId,userId:a.userId}}).done(function(b){p(a.status)})},s=function(a){$.ajax({method:"PUT",url:"/event/uninvite",data:{eventId:a.eventId,userId:a.userId}}).done(function(b){p(a.status)})},t=function(a){var b=parseInt($(".user-id",".event-page").val());$.ajax({method:"POST",url:"/event/userisinvited",data:{userId:b,eventId:window.location.href.match(/\d*$/)[0]}}).done(function(b){c=1==b,"function"==typeof a&&a()})},u=function(){$(".rsvp-btn",".event-page").on("click",function(){var a=parseInt($(this).attr("data-uid"));c?r({status:"G",eventId:window.location.href.match(/\d*$/)[0],userId:a}):$.ajax({method:"POST",url:"/event/addinvite",data:{username:$(".username").val(),eventId:window.location.href.match(/\d*$/)[0]}}).done(function(b){r({status:"G",eventId:window.location.href.match(/\d*$/)[0],userId:a})})})},v=function(){$(".cancel-rsvp-btn",".event-page").on("click",function(){var a=parseInt($(this).attr("data-uid"));s({status:"U",eventId:window.location.href.match(/\d*$/)[0],userId:a})})};return{init:function(){$(".event-page").length&&t(function(){q(),a(),d(),e(),k(),g(),o(),u(),v()})},readyMap:h}}(),$(window).on("load",function(){$(".event-page").length&&WIU.event.readyMap()}),$(function(){WIU.event.init()});var WIU=WIU||{};WIU.events=function(){return{init:function(){if($(".events-page").length){var a=$(".event-row");WIU.animate.slideIn(a)}}}}(),$(function(){WIU.events.init()});var WIU=WIU||{};WIU.findEvents=function(){var a=function(){$("#start-date").datepicker()},b=function(a,b){var c=$(".advance-filters");a=a||"fast",c.hide(a,"linear"),c.addClass("hide"),"function"==typeof b&&b()},c=function(a){var b=$(".advance-filters");a=a||"fast",b.show(a,"linear"),b.removeClass("hide")},d=function(){for(var a=$(".event-category"),b=[],c=0;c<a.length;c++)$(a[c]).is(":checked")&&b.push(parseInt(a[c].value));return 0==b.length&&b.push(7),b},e=function(){$(".toggle-advance-options").on("click",function(a){a.preventDefault(),$(".advance-filters").hasClass("hide")?($(".advance-option").html("hide advance options"),c(300)):($(".advance-option").html("advance options"),b(300))})},f=function(){$(".find-btn").on("click",function(){var a=d();window.location="./event/bycategory/?cid="+a.join("+")})};return{init:function(){$(".find-events-page").length&&(a(),e(),f())}}}(),$(function(){WIU.findEvents.init()});var WIU=WIU||{};WIU.header=function(){var a=function(){$(".site-header.nav").length&&(l(),c(),m())},b=function(){var a=$("#signInResult");f(),i()?j()?(a.text("Please enter in a password."),g()):n():(a.text("Sorry! This email is not a valid email address"),g())},c=function(){var a=$("#signInBtn"),c=$(".password","#header-signin");a.on("click",function(){b()}),c.on("keyup",function(a){13==a.keyCode&&b()})},d=function(a){a.removeClass("btn-outline-secondary"),a.addClass("btn-primary"),a.prop("disabled",!1)},e=function(a){a.removeClass("btn-primary"),a.addClass("btn-outline-secondary"),a.prop("disabled",!0)},f=function(){var a=$(".signInBtn");e(a),a.html('<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>')},g=function(){var a=$(".signInBtn");d(a),a.html("Sign In")},h=function(a){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a)},i=function(){$("#signInResult").text("");var a=$(".email").val();return!!h(a)||($("#signInResult").text(a+" is not valid"),$("#signInResult").css("color","red"),!1)},j=function(){return""===$(".password").val()},k=function(a,b){a.modal("hide"),a.off("hidden.bs.modal").on("hidden.bs.modal",function(){"function"==typeof b&&b()})},l=function(){$(".logoutBtn",".site-header").on("click",function(a){a.preventDefault(),$.ajax({method:"post",url:"/profile/signout"}).done(function(a){WIU.animate.leavePage("/")}).fail(function(a,b,c){console.log("An error occured",a)})})},m=function(){$(".header-btn").hover(function(){WIU.animate.apply($(this),"tada")},function(){})},n=function(){var a={email:$(".email").val(),password:$(".password").val()};$.ajax({method:"post",url:"/profile/signin",data:a}).done(function(a){g(),k($("#header-signin"),function(){WIU.animate.leavePage(window.location.href)})}).fail(function(a,b,c){var d=$("#signInResult");404===a.status?d.html("Incorrect email and/or password"):d.html("An error occured. Please try again later."),g()})};return{init:a}}(),$(function(){WIU.header.init()});var WIU=WIU||{};WIU.landing=function(){var a=function(){$(".find-btn").on("click",function(){WIU.animate.leavePage("/find-events")})},b=function(){var a=$(".create-btn");a.on("click",function(){if(a.hasClass("need-signin"))return $(".sign-in",".site-header").click(),!1;WIU.animate.leavePage("/create-event")})},c=function(){WIU.animate.bounceWords($(".main-title"),400,function(){WIU.animate.apply($(".site-logo"),"rubberBand",function(){WIU.animate.apply($(".slogan.fun-font"),"tada")})}),WIU.animate.slideIn($(".btn"))};return{init:function(){$(".landing-page").length&&(c(),a(),b())}}}(),$(function(){WIU.landing.init()});var WIU=WIU||{};WIU.profile=function(){var a=function(){$(".avatar",".avatar-section").on("click",function(){var a=$(".current-avatar"),b=a.attr("data-id"),c=$(this).attr("data-id");b!==c&&(a.attr("data-id",c),a.addClass("avatar-"+c),a.removeClass("avatar-"+b),WIU.animate.apply(a,"rubberBand"))})},b=function(a){return!(void 0===a.newPW||null===a.newPW||""===a.newPW.trim())},c=function(a,b){return void 0!==a&&null!==a&&""!==a.trim()&&void 0!==b&&null!==b&&""!==b.trim()&&a===b},d=function(a){return void 0!==a.oldPW&&null!==a.oldPW&&""!==a.oldPW.trim()},e=function(a){if($(".error").addClass("hidden"),d(a)){if(!b(a))return $(".error-new-pw").removeClass("hidden"),!1;if(!c(a.newPW,a.confirmPW))return $(".error-confirm").removeClass("hidden"),!1}return!0},f=function(){var a=".edit-profile",b=$(".username",a).val(),c=$(".old-pw",a).val(),d=$(".new-pw",a).val(),e=$(".confirm-pw",a).val();return{userId:parseInt(window.location.href.match(/\d*$/)[0]),username:b,avatar:$(".avatar").attr("data-id"),oldPW:c,newPW:d,confirmPW:e}},g=function(a){return d(a)&&b(a)?a:{userId:a.userId,username:a.username,avatar:a.avatar}},h=function(){$(".update-btn").on("click",function(){var a=f();e(a)?(a=g(a),$.ajax({method:"PUT",url:"/profile/updateuser",data:a}).done(function(a){WIU.animate.leavePage(window.location.href)})):console.log("problem with your input!")})},i=function(){$(".delete-btn").on("click",function(a){$.ajax({method:"DELETE",url:"/profile/delete/"+window.location.href.match(/\d*$/)[0]}).done(function(a){WIU.animate.leavePage("/")})})},j=function(a){return-1!==a.indexOf("tab-events")},k=function(a){return-1!==a.indexOf("tab-yours")},l=function(){$("#profile-tabs").on("shown.bs.tab",function(a){j(a.target.className)?WIU.animate.slideIn($(".invite-row",".event-section")):k(a.target.className)&&WIU.animate.slideIn($(".host-row",".yours-section"))})},m=function(){$(".delete-btn",".control").on("click",function(){})},n=function(a,b){"G"==b?(a.find(".fa-exclamation").removeClass("active"),a.find(".fa-times").removeClass("active"),a.find(".fa-check").addClass("active")):"D"==b&&(a.find(".fa-exclamation").removeClass("active"),a.find(".fa-times").addClass("active"),a.find(".fa-check").removeClass("active"))},o=function(a){$.ajax({method:"PUT",url:"/event/updatestatus",data:{status:a.status,eventId:a.eventId,userId:a.userId}}).done(function(b){console.log("update successful"),n($(".invite-row.event-"+a.eventId,"#events"),a.status)})},p=function(){$(".goBtn").on("click",function(a){a.preventDefault();var b=$(this).attr("data-id"),c={status:"G",eventId:parseInt(b),userId:parseInt(window.location.href.match(/\d*$/)[0])};o(c)})},q=function(){$(".declineBtn").on("click",function(a){a.preventDefault();var b=$(this).attr("data-id"),c={status:"D",eventId:parseInt(b),userId:parseInt(window.location.href.match(/\d*$/)[0])};o(c)})},r=function(){$(".create-btn",".yours-section").on("click",function(){WIU.animate.leavePage("/create-event")})},s=function(){$(".find-btn",".event-section").on("click",function(){WIU.animate.leavePage("/find-events")})};return{init:function(){$(".profile-page").length&&(m(),l(),r(),s(),a(),h(),i(),p(),q())}}}(),$(function(){WIU.profile.init()});var WIU=WIU||{};WIU.signup=function(){var a=function(){return $("#usernameResult").text(""),""!==$("#username").val().trim()},b=function(a){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a)},c=function(){$("#emailResult").text("");var a=$("#email").val();return!!b(a)||($("#emailResult").text(a+" is not valid"),$("#emailResult").css("color","red"),!1)},d=function(){return $("#result").text(""),$("#password").val()===$("#confirm-pw").val()},e=function(){return $("#pwResult").text(""),""===$("#password").val()},f=function(a){$.ajax({method:"POST",url:"./profile/signin",data:{email:a.email,password:a.password}}).done(function(a){WIU.animate.leavePage("./profile/getuser/"+a.id)})},g=function(){var a={username:$("#username").val().trim(),email:$("#email").val().trim(),password:$("#password").val().trim(),avatar:Math.floor(4*Math.random())};$.ajax({method:"POST",url:"./profile/signup",data:a}).done(function(b,c,d){f(a)}).fail(function(a,b,c){console.log("An Error has occurred ",a,b,c)})};return{init:function(){$(".signup-page").length&&$("#signUpBtn").on("click",function(){var b=!0;a()||($("#usernameResult").text("Please enter a valid username."),b=!1),c()||($("#emailResult").text("Sorry! This email is not a valid email address."),b=!1),e()&&($("#pwResult").text("Please enter in a password."),b=!1),d()||($("#result").text("Passwords don't match. Please try again."),b=!1),b&&g()})}}}(),$(function(){WIU.signup.init()});var WIU=WIU||{};WIU.site=function(){var a=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},b=function(b){var c="country-"+a(0,12);b.addClass(c)},c=function(){WIU.animate.apply($("h2.fun-font"),"tada")},d=function(){var b=["swing","bounce","flash","jello","rubberBand","pulse"],c=$(".site-logo");c.length&&WIU.animate.apply(c,b[a(0,b.length-1)])};return{init:function(){b($(".top-region")),b($(".bottom-region")),WIU.animate.bkgSlideIn($(".top-region")),WIU.animate.bkgSlideIn($(".bottom-region"));setInterval(d,4500);c()}}}(),$(function(){WIU.site.init()});